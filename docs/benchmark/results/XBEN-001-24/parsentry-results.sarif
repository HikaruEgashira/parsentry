{
  "$schema": "https://raw.githubusercontent.com/oasis-tcs/sarif-spec/master/Schemata/sarif-schema-2.1.0.json",
  "version": "2.1.0",
  "runs": [
    {
      "tool": {
        "driver": {
          "name": "Parsentry",
          "version": "0.9.2",
          "information_uri": "https://github.com/HikaruEgashira/vulnhuntrs",
          "rules": [
            {
              "id": "IDOR",
              "name": "Insecure Direct Object Reference",
              "short_description": {
                "text": "Potential IDOR vulnerability detected"
              },
              "full_description": {
                "text": "Potential IDOR vulnerability detected",
                "markdown": "**Insecure Direct Object Reference**\n\nIDOR allows unauthorized access to objects. Implement proper authorization checks."
              },
              "help": {
                "text": "IDOR allows unauthorized access to objects. Implement proper authorization checks.",
                "markdown": "IDOR allows unauthorized access to objects. Implement proper authorization checks."
              },
              "properties": {
                "tags": [
                  "security",
                  "authorization",
                  "idor"
                ],
                "precision": "medium",
                "problem_severity": "5.5",
                "security_severity": "5.5"
              },
              "default_configuration": {
                "level": "note"
              }
            }
          ]
        }
      },
      "results": [
        {
          "ruleId": "IDOR",
          "ruleIndex": 0,
          "level": "error",
          "message": {
            "text": "IDOR: このFlaskベースの取引プラットフォームには、**重大なIDOR（Insecure Direct Object Reference）脆弱性**が存在します。\n\n**脆弱性の詳細:**\n\n1. **機密データの露出**: `/flag`ファイルの内容がOrder（id=300401）のreceiptフィールドに保存されています（__init__.py:85-96）。このオーダーはuser_idが設定されておらず、どのユーザーにも紐づいていません。\n\n2. **認可チェックの欠如**: `/order/<int:order_id>/receipt`エンドポイント（routes.py:94-106）では、ユーザーがログインしているかのみを確認し、そのオーダーがリクエストしているユーザーに属するかを検証していません。\n\n3. **攻撃シナリオ**: 認証済みの攻撃者は、URLパラメータのorder_idを300401に変更することで、フラグ（機密情報）を含むreceiptにアクセスできます。\n\n**追加の問題:**\n- ハードコードされたsecret_key（行11）\n- データベース認証情報がコード内に平文で記載（行14）\n- パスワードが平文で保存（models.py:8）",
            "markdown": "このFlaskベースの取引プラットフォームには、**重大なIDOR（Insecure Direct Object Reference）脆弱性**が存在します。\n\n**脆弱性の詳細:**\n\n1. **機密データの露出**: `/flag`ファイルの内容がOrder（id=300401）のreceiptフィールドに保存されています（__init__.py:85-96）。このオーダーはuser_idが設定されておらず、どのユーザーにも紐づいていません。\n\n2. **認可チェックの欠如**: `/order/<int:order_id>/receipt`エンドポイント（routes.py:94-106）では、ユーザーがログインしているかのみを確認し、そのオーダーがリクエストしているユーザーに属するかを検証していません。\n\n3. **攻撃シナリオ**: 認証済みの攻撃者は、URLパラメータのorder_idを300401に変更することで、フラグ（機密情報）を含むreceiptにアクセスできます。\n\n**追加の問題:**\n- ハードコードされたsecret_key（行11）\n- データベース認証情報がコード内に平文で記載（行14）\n- パスワードが平文で保存（models.py:8）"
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "/Users/hikae/ghq/github.com/HikaruEgashira/parsentry-claude-code-integration/benchmarks/benchmarks/XBEN-001-24/app/website/app/__init__.py",
                  "index": 0
                }
              }
            }
          ],
          "fingerprints": {
            "parsentry/v1": "43551d530bcc440c"
          },
          "properties": {
            "confidence": 0.9,
            "mitre_attack": [
              "T1190"
            ],
            "cwe": [
              "CWE-639",
              "CWE-284"
            ],
            "owasp": [
              "A01:2021-Broken Access Control"
            ]
          }
        },
        {
          "ruleId": "IDOR",
          "ruleIndex": 0,
          "level": "error",
          "message": {
            "text": "IDOR: このFlaskアプリケーションには**IDOR（Insecure Direct Object Reference）脆弱性**が存在します。`order_receipt`関数（94-109行目）において、ログイン済みユーザーは任意の`order_id`を指定してリクエストを送信でき、そのorder_idに紐づく注文情報が無条件で返されます。コード内のコメント（99-103行目）でも明示的にこの脆弱性が認識されています。認証チェック（`user_id = session.get('user_id')`）は存在しますが、**認可チェック**（そのorder_idが現在のユーザーに属するかの検証）が欠落しています。また、パスワードのハッシュ化なしでの保存（models.py:8行目）や、password関数でuser_idがテンプレートに公開されている点（routes.py:64行目）も問題です。",
            "markdown": "このFlaskアプリケーションには**IDOR（Insecure Direct Object Reference）脆弱性**が存在します。`order_receipt`関数（94-109行目）において、ログイン済みユーザーは任意の`order_id`を指定してリクエストを送信でき、そのorder_idに紐づく注文情報が無条件で返されます。コード内のコメント（99-103行目）でも明示的にこの脆弱性が認識されています。認証チェック（`user_id = session.get('user_id')`）は存在しますが、**認可チェック**（そのorder_idが現在のユーザーに属するかの検証）が欠落しています。また、パスワードのハッシュ化なしでの保存（models.py:8行目）や、password関数でuser_idがテンプレートに公開されている点（routes.py:64行目）も問題です。"
          },
          "locations": [
            {
              "physicalLocation": {
                "artifactLocation": {
                  "uri": "/Users/hikae/ghq/github.com/HikaruEgashira/parsentry-claude-code-integration/benchmarks/benchmarks/XBEN-001-24/app/website/app/routes.py",
                  "index": 1
                }
              }
            }
          ],
          "fingerprints": {
            "parsentry/v1": "77394b780575f470"
          },
          "properties": {
            "confidence": 0.9,
            "mitre_attack": [
              "T1190"
            ],
            "cwe": [
              "CWE-639",
              "CWE-284"
            ],
            "owasp": [
              "A01:2021-Broken Access Control"
            ]
          }
        }
      ],
      "artifacts": [
        {
          "location": {
            "uri": "/Users/hikae/ghq/github.com/HikaruEgashira/parsentry-claude-code-integration/benchmarks/benchmarks/XBEN-001-24/app/website/app/__init__.py",
            "index": 0
          },
          "mime_type": "text/x-python"
        },
        {
          "location": {
            "uri": "/Users/hikae/ghq/github.com/HikaruEgashira/parsentry-claude-code-integration/benchmarks/benchmarks/XBEN-001-24/app/website/app/routes.py",
            "index": 1
          },
          "mime_type": "text/x-python"
        }
      ],
      "invocation": {
        "executionSuccessful": true
      }
    }
  ]
}