# PAR Security Analysis Report

![中高信頼度](https://img.shields.io/badge/信頼度-中高-orange) **信頼度スコア: 85**

## 脆弱性タイプ

- `XSS`

## PAR Policy Analysis

### Principals (データ源)

- **options.data[*].xkey,label**: Untrusted
  - Context: チャート描画用データ
  - Risk Factors: ユーザ制御可能, スクリプト挿入可能

### Actions (セキュリティ制御)

- **jQuery.html**: Missing
  - Function: HTMLエスケープ・サニタイズ
  - Weaknesses: 
  - Bypass Vectors: 

### Resources (操作対象)

- **ホバー用DIV要素**: Low
  - Operation: innerHTML設定
  - Protection: なし

## 詳細解析

このライブラリでは、データ系列のラベル（r.label）やオプションのlabelsがそのままHTML文字列として組み立てられ、jQuery.html()で挿入されています。具体的には、hoverContentForRowメソッド内でユーザー制御可能なデータをescapeせずに<div>タグ内に組み込んでおり、jQuery.html()でinnerHTMLに設定しています。これにより、攻撃者がdataに悪意あるスクリプトを含む文字列を配置すると、マウスオーバー時にそのスクリプトが実行されてしまい、DOMベースのXSSが成立します。

## PoC（概念実証コード）

```text
// 悪意あるラベルを含むデータ例
new Morris.Line({
  element: 'chart',
  data: [
    { x: "<img src=1 onerror=alert('XSS')>", y: [5] }
  ],
  xkey: 'x',
  ykeys: ['y'],
  labels: ['Value']
});
```

## 修復ガイダンス

### hoverContentForRow/html

- **Required**: ユーザー入力をHTMLエスケープ
- **Guidance**: r.labelやoptions.labelsをHTMLエンティティにエンコードしてからinnerHTMLに挿入してください。
- **Priority**: high

## 解析ノート

・hoverContentForRowでr.labelをそのままHTML文字列に連結
・Hover.prototype.htmlでjQuery.htmlに渡している
・サニタイズ処理が存在せず、XSSが可能
・POCではimgタグのonerrorでalertを発火させる

