# PAR Security Analysis Report

![高信頼度](https://img.shields.io/badge/信頼度-高-red) **信頼度スコア: 90**

## 脆弱性タイプ

- `AFO`

## PAR Policy Analysis

### Principals (データ源)

- *****: Untrusted
  - Context: Terraform aws_s3_bucket_policy.put_object の Principal
  - Risk Factors: 匿名アクセス, ワイルドカードプリンシパル

### Actions (セキュリティ制御)

- **s3:PutObject**: Missing
  - Function: 認可
  - Weaknesses: ワイルドカードプリンシパルによる無制限アクセス, 認可制御の欠如
  - Bypass Vectors: public ポリシーによる許可

### Resources (操作対象)

- **aws_s3_bucket.web**: Medium
  - Operation: オブジェクトアップロード
  - Protection: ignore_public_acls, block_public_acls, restrict_public_buckets

### Policy Violations

#### AWS_S3_PUBLIC_POLICY: 公開バケットポリシーで認証なし PUT を許可

- **Path**: aws_s3_bucket_policy.put_object.policy.Statement[0]
- **Severity**: high
- **Confidence**: 0.90

## 詳細解析

aws_s3_bucket_policy.put_object で Principal="*" に対して s3:PutObject を許可しており、認証なしの任意ユーザーが web バケットにオブジェクトをアップロード可能です。public ACL はブロックされていますが、block_public_policy=false のためポリシーによる公開が有効で、結果として任意ファイルアップロード（AFO）脆弱性が発生しています。

## PoC（概念実証コード）

```text
aws s3api put-object --bucket cg-web-<bucket_suffix> --key test.txt --body /path/to/malicious-file.txt --region <region>
```

## 修復ガイダンス

### aws_s3_bucket_public_access_block.access_block

- **Required**: block_public_policy を true に設定し、バケットポリシーからワイルドカードプリンシパルを排除
- **Guidance**: aws_s3_bucket_public_access_block リソースで block_public_policy=true を有効化し、aws_s3_bucket_policy の Principal を特定の IAM ユーザーまたはロールに限定する。必要に応じてプリサインド URL や IAM ロールベース認証へ移行する。
- **Priority**: high

## 解析ノート

1. Terraform コード検査  
2. aws_s3_bucket_public_access_block: block_public_policy=false が目立つ  
3. aws_s3_bucket_policy.put_object で Principal="*" → 認証不要の PUT 許可  
4. AFO 脆弱性と判定  
5. PAR モデルに落とし込み  
6. remediation は public policy の制限

