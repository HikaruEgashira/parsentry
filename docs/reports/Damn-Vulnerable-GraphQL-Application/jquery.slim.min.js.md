# PAR Security Analysis Report

![中高信頼度](https://img.shields.io/badge/信頼度-中高-orange) **信頼度スコア: 70**

## 脆弱性タイプ

- `XSS`

## PAR Policy Analysis

### Principals (データ源)

- **location.hash**: Untrusted
  - Context: クライアントのURLハッシュ
  - Risk Factors: ユーザー制御可能なURL断片

### Actions (セキュリティ制御)

- **$.fn.html**: Insufficient
  - Function: DOMへのHTML挿入
  - Weaknesses: ユーザー入力をサニタイズせずにinnerHTMLへ挿入
  - Bypass Vectors: <script>...</script> を含む文字列入力

### Resources (操作対象)

- **Element.innerHTML**: Low
  - Operation: DOM insertion
  - Protection: 

### Policy Violations

#### XSS-UNSAFE-DOM: Untrusted input を innerHTML に直接割り当てている

- **Path**: $('selector').html(location.hash)
- **Severity**: high
- **Confidence**: 0.70

## 詳細解析

このjQueryのコード自体には直接的な脆弱性はありませんが、APIの `.html()` や `C(e,t,n)` (グローバルEval) を不用意に使うと、ユーザー入力を検証せずにDOMへHTML/JSを埋め込む経路が残り、XSSを引き起こす可能性があります。

## PoC（概念実証コード）

```text
<script>$(function(){ /* 攻撃者がURLに #<script>alert(1)</script> を付与 */ var payload = location.hash.substring(1); $('body').html(payload); });</script>
```

## 修復ガイダンス

### DOM Sanitization

- **Required**: HTML挿入前に入力をサニタイズまたはエスケープする
- **Guidance**: untrustedな文字列を `.text()` で挿入するか、サニタイザー/libraries (DOMPurify等) を用いてスクリプトタグを除去してください。
- **Priority**: high

## 解析ノート

jQueryの `.html()` はinnerHTMLを呼び出すため、untrusted input を渡すとXSSに直結する。コード内にサニタイズ機能は含まれず、利用者が誤用すると危険。globalEval(C) も同様に危険だが、Slim版ではAjaxとevalUrlは省略されているため主に `.html()` への注意を示した。

