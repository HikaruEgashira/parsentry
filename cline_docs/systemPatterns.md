# System Patterns

## アーキテクチャ概要

### コアコンポーネント
1. Parser (src/parser.rs)
   - Tree-sitterを使用したコード解析
   - 複数言語のサポート
   - AST生成と構文解析

2. Analyzer (src/analyzer.rs)
   - GPTモデルとの連携
   - 段階的な脆弱性分析
   - コンテキスト追跡と依存関係分析

3. Prompts (src/prompts/analysis.rs)
   - 脆弱性タイプごとの分析プロンプト
   - バイパス手法のデータベース
   - 分析ガイドラインの定義

### 技術的決定事項
1. Tree-sitterの採用
   - 高速で正確なパース処理
   - 言語に依存しない統一的なインターフェース
   - カスタマイズ可能な文法定義

2. Stack Graphsの利用
   - コードの依存関係の可視化
   - 名前解決と参照追跡
   - リファクタリングサポート

3. GPTモデルの活用
   - 文脈を考慮した高度な分析
   - 具体的なPoCの生成
   - 段階的な分析プロセス

## データフロー
1. ファイル入力
   - パスの検証
   - コンテンツの読み取り
   - 言語の自動検出

2. 解析プロセス
   - AST生成
   - 依存関係グラフの構築
   - コンテキストの収集

3. 脆弱性分析
   - 初期スキャン
   - 詳細分析
   - PoC生成

4. レポート生成
   - JSON形式のレスポンス
   - 信頼度スコアの計算
   - コンテキストコードの収集

## エラーハンドリング
1. パース時のエラー処理
2. API通信のエラー処理
3. ファイル操作のエラー処理
4. JSON解析のエラー処理
