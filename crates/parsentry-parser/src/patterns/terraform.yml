principals:
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "variable")
        (string_lit) @name) @definition
    description: "Variable declarations"
    attack_vector:
      - "T1190"
      - "T1021"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "data")
        (string_lit) @resource_type
        (string_lit) @name) @definition
    description: "Data sources"
    attack_vector:
      - "T1083"
      - "T1005"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "module")
        (string_lit) @name) @definition
    description: "Module declarations"
    attack_vector:
      - "T1105"
      - "T1027"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "provider")
        (string_lit) @name) @definition
    description: "Provider configurations"
    attack_vector:
      - "T1078"
      - "T1550"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "locals")) @definition
    description: "Local value definitions"
    attack_vector:
      - "T1083"
      - "T1082"

actions:
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "validation")) @definition
    description: "Input validation"
    attack_vector:
      - "T1070"
      - "T1027"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "lifecycle")) @definition
    description: "Lifecycle management"
    attack_vector:
      - "T1485"
      - "T1490"
  - reference: |
      (attribute
        (identifier) @attr_name (#eq? @attr_name "sensitive")
        (expression
          (literal_value) @value (#eq? @value "true"))) @attribute
    description: "Sensitive variable marking"
    attack_vector:
      - "T1552"
      - "T1078"
  - reference: |
      (attribute
        (identifier) @attr_name (#match? @attr_name "^(encrypted|encryption|encrypt)$")
        (expression
          (literal_value) @value (#eq? @value "true"))) @attribute
    description: "Encryption enablement"
    attack_vector:
      - "T1027"
      - "T1486"

resources:
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "aws_s3")
        (string_lit) @name) @definition
    description: "AWS S3 bucket resources"
    attack_vector:
      - "T1530"
      - "T1537"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "aws_iam")
        (string_lit) @name) @definition
    description: "AWS IAM resources"
    attack_vector:
      - "T1078"
      - "T1484"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "aws_security_group")
        (string_lit) @name) @definition
    description: "AWS security group resources"
    attack_vector:
      - "T1190"
      - "T1021"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "aws_db")
        (string_lit) @name) @definition
    description: "AWS RDS database resources"
    attack_vector:
      - "T1190"
      - "T1213"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "aws_instance")
        (string_lit) @name) @definition
    description: "AWS EC2 instance resources"
    attack_vector:
      - "T1078"
      - "T1106"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "aws_lambda")
        (string_lit) @name) @definition
    description: "AWS Lambda function resources"
    attack_vector:
      - "T1059"
      - "T1078"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "google_storage")
        (string_lit) @name) @definition
    description: "Google Cloud Storage resources"
    attack_vector:
      - "T1530"
      - "T1537"
  - definition: |
      (block
        (identifier) @block_type (#eq? @block_type "resource")
        (string_lit) @resource_type (#match? @resource_type "azurerm_storage")
        (string_lit) @name) @definition
    description: "Azure storage resources"
    attack_vector:
      - "T1530"
      - "T1537"
  - reference: |
      (attribute
        (identifier) @attr_name (#match? @attr_name "cidr_block")
        (expression) @value) @attribute
    description: "Network CIDR configuration"
    attack_vector:
      - "T1190"
      - "T1021"
  - reference: |
      (attribute
        (identifier) @attr_name (#eq? @attr_name "publicly_accessible")
        (expression
          (literal_value) @value (#eq? @value "true"))) @attribute
    description: "Publicly accessible resource"
    attack_vector:
      - "T1190"
      - "T1213"
  - reference: |
      (attribute
        (identifier) @attr_name (#match? @attr_name "^(encrypted|encryption)$")
        (expression
          (literal_value) @value (#eq? @value "false"))) @attribute
    description: "Unencrypted storage"
    attack_vector:
      - "T1005"
      - "T1213"
  - reference: |
      (attribute
        (identifier) @attr_name (#match? @attr_name "logging|enable_logging")
        (expression
          (literal_value) @value (#eq? @value "false"))) @attribute
    description: "Disabled logging"
    attack_vector:
      - "T1562"
      - "T1070"
