# PAR Model Security Patterns
# Principal-Action-Resource unified patterns for Programming & IaC

Python:
  principals:
    - pattern: "async\\sdef\\s\\w+\\(.*?request"
      description: "HTTP request handlers (external input principal)"
    - pattern: "@app\\.route\\(.*?\\)"
      description: "Flask route decorators (web principal)"
    - pattern: "\\brequests\\."
      description: "HTTP requests library (external API principal)"
    - pattern: "\\bsocket\\."
      description: "Network socket operations (network principal)"
    - pattern: "urllib\\."
      description: "URL handling modules (web principal)"
    - pattern: "input\\s*\\("
      description: "User input function (user principal)"
    - pattern: "sys\\.argv"
      description: "Command line arguments (CLI principal)"
  
  actions:
    - pattern: "\\bhtml\\.escape\\s*\\("
      description: "HTML escaping action"
    - pattern: "\\bre\\.(match|search)\\s*\\("
      description: "Regex validation action"
    - pattern: "\\bbleach\\."
      description: "HTML sanitization action"
    - pattern: "\\bpydantic\\."
      description: "Data validation action"
    - pattern: "\\bwerkzeug\\.security\\."
      description: "Security utilities action"
    - pattern: "\\bhashlib\\."
      description: "Hash functions action"
    - pattern: "\\bos\\.path\\.(abspath|realpath)\\s*\\("
      description: "Path validation action"
  
  resources:
    - pattern: "\\bopen\\s*\\("
      description: "File operations resource"
    - pattern: "\\bsubprocess\\."
      description: "Process execution resource"
    - pattern: "\\bos\\.system\\s*\\("
      description: "System command execution resource"
    - pattern: "\\beval\\s*\\("
      description: "Code evaluation resource"
    - pattern: "\\bexec\\s*\\("
      description: "Code execution resource"
    - pattern: "\\.execute\\s*\\("
      description: "SQL execution resource"

JavaScript:
  principals:
    - pattern: "fetch\\(.*?\\)"
      description: "Fetch API requests (external principal)"
    - pattern: "XMLHttpRequest"
      description: "XMLHttpRequest API (external principal)"
    - pattern: "require\\s*\\("
      description: "Module imports (external principal)"
    - pattern: "process\\.env"
      description: "Environment variables (system principal)"
    - pattern: "document\\.(getElementById|querySelector)"
      description: "DOM access (user interface principal)"
  
  actions:
    - pattern: "\\bvalidator\\."
      description: "Validator.js library action"
    - pattern: "\\bDOMPurify\\."
      description: "DOM sanitization action"
    - pattern: "\\bescape-html"
      description: "HTML escaping action"
    - pattern: "\\bxss\\s*\\("
      description: "XSS filtering action"
    - pattern: "\\bhelmet\\."
      description: "Security middleware action"
    - pattern: "\\bbcrypt\\."
      description: "Password hashing action"
    - pattern: "\\.normalize\\s*\\("
      description: "Data normalization action"
  
  resources:
    - pattern: "\\beval\\s*\\("
      description: "Code evaluation resource"
    - pattern: "document\\.write\\s*\\("
      description: "Document write operations resource"
    - pattern: "\\.innerHTML\\s*="
      description: "HTML injection resource"
    - pattern: "child_process"
      description: "Process execution resource"
    - pattern: "fs\\.writeFile"
      description: "File writing resource"

# IaC Languages with same PAR structure

Terraform:
  principals:
    - pattern: "variable\\s+\"[^\"]*\"\\s*\\{"
      description: "Variable declarations (external input principal)"
    - pattern: "data\\s+\"[^\"]*\"\\s+\"[^\"]*\"\\s*\\{"
      description: "Data sources (external information principal)"
    - pattern: "module\\s+\"[^\"]*\"\\s*\\{"
      description: "Module declarations (external dependency principal)"
    - pattern: "provider\\s+\"[^\"]*\"\\s*\\{"
      description: "Provider configurations (cloud principal)"
    - pattern: "locals\\s*\\{"
      description: "Local value definitions (internal principal)"
    - pattern: "arn:aws:iam::[0-9]*:root"
      description: "AWS root account (external principal)"
    - pattern: "arn:aws:iam::[0-9]*:"
      description: "Cross-account access (external principal)"
  
  actions:
    - pattern: "validation\\s*\\{"
      description: "Input validation action"
    - pattern: "condition\\s*="
      description: "Validation conditions action"
    - pattern: "error_message\\s*="
      description: "Validation error messages action"
    - pattern: "sensitive\\s*=\\s*true"
      description: "Sensitive variable marking action"
    - pattern: "type\\s*=\\s*(string|number|bool|list|map|set|object|tuple)"
      description: "Type constraints action"
    - pattern: "encrypted\\s*=\\s*true"
      description: "Encryption enablement action"
    - pattern: "versioning.*enabled\\s*=\\s*true"
      description: "Versioning enablement action"
  
  resources:
    - pattern: "(password|secret|key|token)\\s*=\\s*\"[^\"]+\""
      description: "Hardcoded secrets resource"
    - pattern: "access_key\\s*=\\s*\"[^\"]+\""
      description: "Hardcoded AWS access keys resource"
    - pattern: "cidr_blocks\\s*=\\s*\\[\\s*\"0\\.0\\.0\\.0/0\"\\s*\\]"
      description: "Overly permissive network access resource"
    - pattern: "publicly_accessible\\s*=\\s*true"
      description: "Public database resource"
    - pattern: "encrypted\\s*=\\s*false"
      description: "Unencrypted storage resource"
    - pattern: "enable_logging\\s*=\\s*false"
      description: "Disabled logging resource"
    - pattern: "backup_retention_period\\s*=\\s*0"
      description: "No backup retention resource"
    - pattern: "deletion_protection\\s*=\\s*false"
      description: "No deletion protection resource"

Kubernetes:
  principals:
    - pattern: "kind:\\s*ServiceAccount"
      description: "Service account principal"
    - pattern: "kind:\\s*User"
      description: "User principal"
    - pattern: "kind:\\s*Group"
      description: "Group principal"
    - pattern: "system:masters"
      description: "Cluster admin principal"
    - pattern: "system:anonymous"
      description: "Anonymous access principal"
  
  actions:
    - pattern: "verbs:\\s*\\[.*\"\\*\".*\\]"
      description: "Wildcard permissions action"
    - pattern: "resources:\\s*\\[.*\"\\*\".*\\]"
      description: "All resources access action"
    - pattern: "apiGroups:\\s*\\[.*\"\\*\".*\\]"
      description: "All API groups access action"
    - pattern: "readOnlyRootFilesystem:\\s*true"
      description: "Read-only filesystem security action"
    - pattern: "runAsNonRoot:\\s*true"
      description: "Non-root execution security action"
  
  resources:
    - pattern: "privileged:\\s*true"
      description: "Privileged container resource"
    - pattern: "hostNetwork:\\s*true"
      description: "Host network access resource"
    - pattern: "hostPID:\\s*true"
      description: "Host PID access resource"
    - pattern: "containers:.*image:.*latest"
      description: "Latest tag container resource"
    - pattern: "type:\\s*LoadBalancer"
      description: "LoadBalancer service resource"

# Additional languages following same PAR pattern...

Rust:
  principals:
    - pattern: "async\\s+fn\\s+\\w+.*?Request"
      description: "HTTP request handlers principal"
    - pattern: "#\\[.*?route.*?\\]"
      description: "Route attributes principal"
    - pattern: "reqwest::"
      description: "HTTP client library principal"
    - pattern: "std::env::"
      description: "Environment variables principal"
  
  actions:
    - pattern: "\\bserde\\."
      description: "Serialization validation action"
    - pattern: "\\bvalidator\\."
      description: "Validation crate action"
    - pattern: "\\bregex\\."
      description: "Regex validation action"
    - pattern: "\\bammonia\\."
      description: "HTML sanitization action"
    - pattern: "\\bsha2::"
      description: "Hash functions action"
    - pattern: "\\bbcrypt::"
      description: "Password hashing action"
    - pattern: "\\bpath\\.canonicalize\\s*\\("
      description: "Path normalization action"
  
  resources:
    - pattern: "std::fs::write"
      description: "File writing resource"
    - pattern: "std::process::Command"
      description: "Process execution resource"
    - pattern: "\\.execute\\s*\\("
      description: "Database execution resource"